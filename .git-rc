#!/usr/bin/env bash

# Git aliases. source me from .bashrc!

if [ -n "$ZSH_VERSION" ]; then
  dir="$(dirname $0)"
else
  dir="$(dirname "${BASH_SOURCE[0]}")"
fi

dir="$(cd "$dir" && echo "$PWD")"
export GIT_HELPERS_HOME="$dir"

[ -s "$dir/.gitcomplete" ] && source "$dir/.gitcomplete"

if [ -n "$BASH_VERSION" ]; then
  [ -s "$dir/.git-completion.bash" ] && source "$dir/.git-completion.bash"
fi

define-function() {
  name="$1"
  shift
  eval "$name() { $@ \"\$@\"; }"
  export -f "$name" > /dev/null
}
alias defn=define-function

append_to_path() {
  for arg in "$@"; do
    if [ -d "$arg" ]; then
      export PATH="$PATH:$arg"
    fi
  done
}

append_subdir_to_path() {
  append_to_path "$dir/$1" "$dir/$1/aliases"
  if [ -s "$dir/$1/.git-rc" ]; then
    source "$dir/$1/.git-rc"
  fi
}

append_to_path "$dir" "$dir/aliases" "$dir"/github

append_subdir_to_path add
append_subdir_to_path admin
append_subdir_to_path aliases
append_subdir_to_path apply
append_subdir_to_path bisect
append_subdir_to_path blame
append_subdir_to_path branch
append_subdir_to_path cat-file
append_subdir_to_path checkout
append_subdir_to_path check-ignore
append_subdir_to_path cherry-pick
append_subdir_to_path clone
append_subdir_to_path commit
append_subdir_to_path config
append_subdir_to_path conflicts
append_subdir_to_path describe
append_subdir_to_path diff
append_subdir_to_path fetch
append_subdir_to_path github
append_subdir_to_path graph
append_subdir_to_path grep
append_subdir_to_path help
append_subdir_to_path lfs
append_subdir_to_path log
append_subdir_to_path ls
append_subdir_to_path merge
append_subdir_to_path merge-base
append_subdir_to_path mv
append_subdir_to_path nav
append_subdir_to_path push
append_subdir_to_path rebase
append_subdir_to_path reflog
append_subdir_to_path remote
append_subdir_to_path reset
append_subdir_to_path rev-list
append_subdir_to_path rm
append_subdir_to_path show
append_subdir_to_path stash
append_subdir_to_path status
append_subdir_to_path submodule
append_subdir_to_path tag
append_subdir_to_path version
append_subdir_to_path watchman

export o="origin"
export oh="origin/HEAD"

export u="upstream"
export uh="upstream/HEAD"

export DEFAULT_REMOTE="${DEFAULT_REMOTE:-origin}"

export h="HEAD"

export p="HEAD^"
export p2="HEAD~2"
export p3="HEAD~3"
export p4="HEAD~4"
export p5="HEAD~5"

export h1="HEAD@{1}"
export h2="HEAD@{2}"
export h3="HEAD@{3}"
export h4="HEAD@{4}"
export h5="HEAD@{5}"
export h6="HEAD@{6}"
export h7="HEAD@{7}"
export h8="HEAD@{8}"
export h9="HEAD@{9}"
export h10="HEAD@{10}"
export h11="HEAD@{11}"
export h12="HEAD@{12}"
export h13="HEAD@{13}"
export h14="HEAD@{14}"
export h15="HEAD@{15}"
export h16="HEAD@{16}"
export h17="HEAD@{17}"
export h18="HEAD@{18}"
export h19="HEAD@{19}"
export h20="HEAD@{20}"

export s0="stash@{0}"
export s1="stash@{1}"
export s2="stash@{2}"
export s3="stash@{3}"
export s4="stash@{4}"
export s5="stash@{5}"
export s6="stash@{6}"
export s7="stash@{7}"
export s8="stash@{8}"
export s9="stash@{9}"
export s10="stash@{10}"

export pr="$DEFAULT_REMOTE/pr"

alias snippets='git log --since "8days" --oneline --author $USER'

export PYTHONPATH="$PYTHONPATH:$dir/util"

### Aliases for `gist` utility: https://github.com/defunkt/gist ###
# Private gist, copy link to clipboard, parse first argument as gist description
alias gst="gist -p -c -d"
# Same as above, but open in browser ("-o")
alias gsto="gist -p -c -o -d"
# Same as above, but pulling content from clipboard
alias gstp="gist -p -c -o -P -d"

alias gop="gist -op"
alias gopc="gist -opc"
alias gpc="gist -opc"

# Source this repository's `.gitconfig` file from your global `.gitconfig`.
config_file="$dir"/config/.gitconfig
if ! git config --global --get-all include.path | grep "$config_file" >/dev/null; then
  git config --global --add include.path "$config_file"
fi

set-sha() {
  export sha="$(git sha)"
}

if [ -n "$GLOBAL_GIT_IGNORE_PATH" ]; then
  git config --global core.excludesfile "$GLOBAL_GIT_IGNORE_PATH"
fi
